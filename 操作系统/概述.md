### 用户态与内核态

因为操作系统的内核可以访问受保护的内存空间，也有访问底层硬件设备的权限。为了保证内核安全，避免用户进程直接操作内核，操作系统将虚拟内存划分为两部分，一部分是内核空间 (Kernel-space)，一部分是用户空间 (User-space)。 

当一个进程执行系统调用而陷入内核代码中执行时，我们就称进程处于**内核态**。当进程在执行用户自己的代码时，则称其处于用户态。

这些系统调用按功能大致可分为如下几类：

* 进程管理。完成进程的创建、撤销、阻塞及唤醒等功能。
* 进程通信。完成进程之间的消息传递或信号传递等功能。
* 内存管理。完成内存的分配、回收以及获取作业占用内存区大小及地址等功能。
* 文件管理。完成文件的读、写、创建及删除等功能。
* 设备管理。完成设备的请求或释放，以及设备启动等功能。

### 上下文切换

当一个进程在执行时，CPU 所有寄存器中的值、程序计数器的值以及进程的状态被称为该进程的上下文。

当内核需要 CPU 切换到另一个进程时，它需要保存当前进程的所有状态信息，即保存当前进程的上下文，同时将新的活动进程的上下文信息加载进来，这个过程其实就是上下文切换。

### 死锁

#### 必要条件

* 互斥：资源同时只能由一个进程占有。
* 不可剥夺：不能抢别的进程的资源，只能等着对方放开。
* 占有且申请：申请其他资源时不放开自己已占有的资源。
* 循环等待：若干进程之间形成一种头尾相接的循环等待资源关系。

#### 死锁预防

##### 打破占有且申请

可以实行资源预先分配策略。即进程在运行前一次性地向系统申请它所需要的全部资源。如果某个进程所需的全部资源得不到满足，则不分配任何资源，此进程暂不运行。只有当系统能够满足当前进程的全部资源需求时，才一次性地将所申请的资源全部分配给该进程。

##### 打破循环等待

实行资源有序分配策略。采用这种策略，即把资源事先分类编号，按号分配，使进程在申请，占用资源时不会形成环路。所有进程对资源的请求必须严格按资源序号递增的顺序提出。进程占用了小号资源，才能申请大号资源，就不会产生环路，从而预防了死锁。
