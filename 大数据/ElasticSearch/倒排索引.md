### 倒排索引结构

倒排索引就是关键词到文档 ID 的映射，每个关键词都对应着一系列的文件，并且根据出现频率对文档排序。有了关键词和文档的映射关系表，就能实现$O(1)$时间复杂度检索文章了。倒排索引由两部分组成——词典和倒排表。

<img src="/Users/licheng/Documents/Typora/Picture/image-20200716201305336.png" alt="image-20200716201305336" style="zoom:67%;" />

* Term Dictionary：保存着所有的 term，即单词。
* Posting List：保存着每个 term 所在的文档列表。
* Term Index：单词数量如果过多，那么查询也会很慢。所以使用前缀树来加速单词的查找。

<img src="/Users/licheng/Documents/Typora/Picture/image-20200716201330889.png" alt="image-20200716201330889" style="zoom:67%;" />

倒排索引的底层实现是基于：FST (Finite State Transducer) 数据结构。

* 空间占用小。通过对词典中单词前缀和后缀的重复利用，压缩了存储空间。

* 查询速度快。$O(len(str))$的查询时间复杂度。

倒排索引被写入磁盘后是不可改变的，这带来了以下几个优势：

* 不需要锁。如果你从来不更新索引，你就不需要担心多进程同时修改数据的问题。

* 一旦索引被读入内核的文件系统缓存，便会留在哪里。由于其不变性，只要文件系统缓存中还有足够的空间，那么大部分读请求会直接请求内存，而不会命中磁盘。这提供了很大的性能提升。

* 其它缓存 (像 filter 缓存)，在索引的生命周期内始终有效。它们不需要在每次数据改变时被重建，因为数据不会变化。

* 写入单个大的倒排索引允许数据被压缩，减少磁盘 I/O 和 需要被缓存到内存的索引的使用量。

